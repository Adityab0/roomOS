<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RoomOS Mobile</title>
    <style>
        /* --- THEMES --- */
        :root {
            --bg: #f2f2f7;
            --card-bg: #ffffff;
            --text: #000000;
            --text-sub: #8e8e93;
            --primary: #007AFF;
            --accent: #34C759;
            --danger: #FF3B30;
            --warning: #FF9500;
            --purple: #AF52DE;
            --border: #e5e5ea;
            --nav-bg: #ffffff;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --morn-bg: #f0f8ff;
            --night-bg: #f5f5f7;
        }

        [data-theme="dark"] {
            --bg: #000000;
            --card-bg: #1c1c1e;
            --text: #ffffff;
            --text-sub: #98989d;
            --primary: #0A84FF;
            --accent: #30D158;
            --danger: #FF453A;
            --warning: #FF9F0A;
            --purple: #BF5AF2;
            --border: #38383a;
            --nav-bg: #1c1c1e;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            --morn-bg: #1c1c1e;
            --night-bg: #2c2c2e;
        }

        body {
            margin: 0;
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            transition: background 0.3s, color 0.3s;
        }

        /* --- HEADER --- */
        header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            z-index: 10;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .theme-toggle {
            background: var(--bg);
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* --- MAIN CONTENT --- */
        main {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        main::-webkit-scrollbar {
            display: none;
        }

        .page {
            display: none;
            animation: fadeUp 0.3s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- CARD STYLES --- */
        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .card h2 {
            margin-top: 0;
            font-size: 0.75rem;
            color: var(--text-sub);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        /* --- DASHBOARD SPECIFIC --- */
        .status-big {
            font-size: 1.5rem;
            font-weight: 800;
            line-height: 1.2;
            display: block;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.7rem;
        }

        .badge-m {
            background: var(--accent);
            color: #fff;
        }

        .badge-n {
            background: var(--danger);
            color: #fff;
        }

        .dash-task-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .dash-task-row:last-child {
            border-bottom: none;
        }

        /* --- ROSTER UI (REDESIGNED) --- */
        .roster-card {
            background: var(--card-bg);
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .roster-header {
            padding: 10px 15px;
            background: var(--card-bg);
            font-weight: 800;
            font-size: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .today-tag {
            font-size: 0.7rem;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .today-glow {
            border: 2px solid var(--primary);
        }

        /* Split Layout */
        .shift-row {
            display: flex;
            flex-direction: column;
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }

        .shift-row:last-child {
            border-bottom: none;
        }

        .shift-row.morning {
            background: var(--morn-bg);
        }

        .shift-row.night {
            background: var(--night-bg);
        }

        .shift-label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .shift-icon {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-sub);
            text-transform: uppercase;
        }

        .pass-tag {
            font-size: 0.7rem;
            color: var(--danger);
            background: rgba(255, 59, 48, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .worker-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .worker-chip {
            font-size: 0.85rem;
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
            display: flex;
            align-items: center;
        }

        .time-tiny {
            font-size: 0.7rem;
            color: var(--text-sub);
            margin-left: 6px;
        }

        /* --- CREW CARDS --- */
        .crew-card {
            display: flex;
            flex-direction: column;
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .crew-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .crew-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
            margin-right: 15px;
        }

        .crew-info h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .crew-info span {
            font-size: 0.8rem;
            color: var(--text-sub);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .stat-label {
            color: var(--text-sub);
        }

        .stat-val {
            font-weight: 600;
        }

        .bar-container {
            height: 6px;
            width: 100%;
            background: var(--bg);
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 10px;
        }

        .role-tag {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 0.7rem;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 6px;
            background: var(--bg);
            color: var(--text);
        }

        /* --- LOTTERY --- */
        .draw-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 1px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 8px 20px rgba(0, 122, 255, 0.25);
            transition: transform 0.1s;
        }

        .draw-btn:active {
            transform: scale(0.97);
        }

        /* --- RULES --- */
        .rule-row {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .rule-idx {
            font-weight: 800;
            color: var(--primary);
            width: 30px;
            flex-shrink: 0;
        }

        /* --- BOTTOM NAV --- */
        nav {
            background: var(--nav-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding-bottom: env(safe-area-inset-bottom);
            height: 60px;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-sub);
            background: none;
            border: none;
            font-size: 0.65rem;
            cursor: pointer;
            font-weight: 500;
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 3px;
        }

        .nav-item.active {
            color: var(--primary);
        }
    </style>
</head>

<body>

    <header>
        <h1>RoomOS</h1>
        <button class="theme-toggle" onclick="toggleTheme()">üåó</button>
    </header>

    <main>
        <div id="home" class="page active">
            <div class="card">
                <h2>Live Protocol</h2>
                <span class="status-big" id="dash-status">Loading...</span>
                <div class="status-row">
                    <span style="font-size:0.85rem; color:var(--text-sub)">Active Team (Cook+Clean)</span>
                    <span class="badge badge-m" id="dash-badge">SHIFT</span>
                </div>
            </div>

            <div class="card">
                <h2>Passenger (Off-Duty)</h2>
                <span class="status-big" id="passenger-name">...</span>
                <div class="status-row">
                    <span style="font-size:0.85rem; color:var(--text-sub)">Relaxing / Sleeping / Class</span>
                </div>
            </div>

            <div class="card">
                <h2>Today's Micro-Tasks</h2>
                <div id="dash-task-container">
                    <div style="text-align:center; padding:15px; color:var(--text-sub); font-size:0.9rem;">
                        <div style="font-size:2rem; margin-bottom:5px;">üé≤</div>
                        Tasks not assigned yet.<br>
                        <a onclick="nav('lottery', document.getElementById('btn-lotto'))"
                            style="color:var(--primary); font-weight:bold; cursor:pointer;">Go to Lottery</a>
                    </div>
                </div>
            </div>
        </div>

        <div id="roster" class="page">
            <div style="text-align:center; margin-bottom:15px; color:var(--text-sub); font-size:0.8rem;">
                Plan optimized for College Timings
            </div>
            <div id="roster-list"></div>
        </div>

        <div id="lottery" class="page">
            <div class="card" style="text-align:center; border:none; background:transparent; box-shadow:none;">
                <h2 style="margin-bottom:20px;">Random Assignment</h2>
                <button id="lottery-draw-btn" class="draw-btn" onclick="runLottery()">üé≤ SPIN THE WHEEL</button>
                <p style="margin-top:15px; font-size:0.8rem; color:var(--text-sub);">
                    Tap to assign Brooming, Water, Trash & Market. Results will sync to Home.
                </p>
            </div>

            <div id="lottery-result-card" class="card" style="display:none; animation: fadeUp 0.4s;">
                <h2>Assignment Results</h2>
                <div id="lottery-list"></div>
            </div>
        </div>

        <div id="crew" class="page">
            <div class="crew-card">
                <div class="role-tag" style="color:var(--primary)">SYS_ADMIN</div>
                <div class="crew-header">
                    <div class="crew-avatar" style="background:var(--primary)">A</div>
                    <div class="crew-info">
                        <h3>Aditya</h3><span>BCA Student</span>
                    </div>
                </div>
                <div class="stat-row"><span class="stat-label">Primary Duty</span><span class="stat-val">Network &
                        Hardware</span></div>
                <div class="stat-row"><span class="stat-label">Weekly Shifts</span><span class="stat-val">8 / 14</span>
                </div>
                <div class="bar-container">
                    <div class="bar-fill" style="width:57%; background:var(--primary)"></div>
                </div>
            </div>

            <div class="crew-card">
                <div class="role-tag" style="color:var(--accent)">MEDIC</div>
                <div class="crew-header">
                    <div class="crew-avatar" style="background:var(--accent)">P</div>
                    <div class="crew-info">
                        <h3>Priyanshu</h3><span>Medical Student</span>
                    </div>
                </div>
                <div class="stat-row"><span class="stat-label">Primary Duty</span><span class="stat-val">Inventory &
                        Hygiene</span></div>
                <div class="stat-row"><span class="stat-label">Weekly Shifts</span><span class="stat-val">8 / 14</span>
                </div>
                <div class="bar-container">
                    <div class="bar-fill" style="width:57%; background:var(--accent)"></div>
                </div>
            </div>

            <div class="crew-card">
                <div class="role-tag" style="color:var(--danger)">ROOT</div>
                <div class="crew-header">
                    <div class="crew-avatar" style="background:var(--danger)">S</div>
                    <div class="crew-info">
                        <h3>Sumit</h3><span>MCA Senior</span>
                    </div>
                </div>
                <div class="stat-row"><span class="stat-label">Primary Duty</span><span class="stat-val">Finance &
                        Disputes</span></div>
                <div class="stat-row"><span class="stat-label">Weekly Shifts</span><span class="stat-val">9 / 14</span>
                </div>
                <div class="bar-container">
                    <div class="bar-fill" style="width:64%; background:var(--danger)"></div>
                </div>
            </div>
        </div>

        <div id="rules" class="page">
            <div class="card">
                <h2>The 10 Commandments</h2>
                <div class="rule-row">
                    <div class="rule-idx">1.</div>
                    <div><strong>The 2-Man Rule:</strong> Two people work (Cook+Clean). One person (Passenger) rests.
                    </div>
                </div>
                <div class="rule-row">
                    <div class="rule-idx">2.</div>
                    <div><strong>The Passenger:</strong> If you are off-duty, you do zero house work. But you cannot
                        complain about the food.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-idx">3.</div>
                    <div><strong>Lottery is Law:</strong> Micro-task assignments are final.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-idx">4.</div>
                    <div><strong>Quiet Hours:</strong> 11:00 PM to 7:00 AM.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-idx">5.</div>
                    <div><strong>Dishes:</strong> Rinse immediately. No dried curry.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-idx">6.</div>
                    <div><strong>Guests:</strong> Inform 24hr prior. You clean up after them.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-idx">7.</div>
                    <div><strong>Money:</strong> Bills settled on the 1st.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-idx">8.</div>
                    <div><strong>Bathroom:</strong> You clog it, you unclog it.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-idx">9.</div>
                    <div><strong>Damage:</strong> You break it, you buy it.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-idx">10.</div>
                    <div><strong>Wi-Fi:</strong> No torrenting if net is slow.</div>
                </div>
            </div>
        </div>

    </main>

    <nav>
        <button class="nav-item active" onclick="nav('home', this)"><span
                class="nav-icon">üè†</span><span>Home</span></button>
        <button class="nav-item" onclick="nav('roster', this)"><span
                class="nav-icon">üìÖ</span><span>Plan</span></button>
        <button class="nav-item" id="btn-lotto" onclick="nav('lottery', this)"><span
                class="nav-icon">üé≤</span><span>Lottery</span></button>
        <button class="nav-item" onclick="nav('crew', this)"><span class="nav-icon">üë•</span><span>Crew</span></button>
        <button class="nav-item" onclick="nav('rules', this)"><span
                class="nav-icon">üìú</span><span>Rules</span></button>
    </nav>

    <script>
        // --- DATA CONFIG ---
        // pm = Passenger Morning, pn = Passenger Night
        const rosterData = [
            { d: "Monday", m: [{ n: "Aditya", t: "Till 11am" }, { n: "Sumit", t: "Till 1pm" }], pm: "Priyanshu", n: [{ n: "Priyanshu", t: "After 3pm" }, { n: "Sumit", t: "After 5pm" }], pn: "Aditya" },
            { d: "Tuesday", m: [{ n: "Priyanshu", t: "Till 1pm" }, { n: "Sumit", t: "Till 1pm" }], pm: "Aditya", n: [{ n: "Aditya", t: "After 5pm" }, { n: "Priyanshu", t: "After 5pm" }], pn: "Sumit" },
            { d: "Wednesday", m: [{ n: "Aditya", t: "Till 3:30pm" }, { n: "Priyanshu", t: "Till 3pm" }], pm: "Sumit", n: [{ n: "Aditya", t: "After 6pm" }, { n: "Sumit", t: "After 5pm" }], pn: "Priyanshu" },
            { d: "Thursday", m: [{ n: "Aditya", t: "Till 12pm" }, { n: "Sumit", t: "Till 11am" }], pm: "Priyanshu", n: [{ n: "Priyanshu", t: "After 4pm" }, { n: "Sumit", t: "After 6pm" }], pn: "Aditya" },
            { d: "Friday", m: [{ n: "Aditya", t: "Day Off" }, { n: "Priyanshu", t: "Day Off" }], pm: "Sumit", n: [{ n: "Aditya", t: "Free" }, { n: "Sumit", t: "Free" }], pn: "Priyanshu" },
            { d: "Saturday", m: [{ n: "Priyanshu", t: "Day Off" }, { n: "Sumit", t: "Day Off" }], pm: "Aditya", n: [{ n: "ORDER FOOD", t: "Chill" }], pn: "Everyone" },
            { d: "Sunday", m: [{ n: "Aditya", t: "Till 1pm" }], pm: "Priyanshu & Sumit", n: [{ n: "Priyanshu", t: "After 6pm" }, { n: "Sumit", t: "After 5pm" }], pn: "Aditya" }
        ];

        const tasks = ["üßπ Brooming", "üíß Water Bottles", "üóëÔ∏è Trash Disposal", "ü•õ Market Run"];
        const people = ["Aditya", "Priyanshu", "Sumit"];

        /*
        // --- PENALTY STATE ---
        // Structure: { person: "Name", date: "YYYY-MM-DD" }
        let penaltyState = null;
        */

        // --- CORE FUNCTIONS ---
        function nav(pageId, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function toggleTheme() {
            const body = document.body;
            const current = body.getAttribute('data-theme');
            body.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
        }

        // --- DASHBOARD LOGIC ---
        function updateDashboard() {
            const now = new Date();
            let dayIdx = now.getDay() - 1;
            if (dayIdx === -1) dayIdx = 6; // Sunday fix

            const h = now.getHours();
            const isMorn = h < 16;
            const data = rosterData[dayIdx];

            // Status Update
            const team = isMorn ? data.m : data.n;
            const names = team.map(x => x.n).join(" + ");

            // FIX: Explicitly using pm (morning pass) or pn (night pass)
            const passName = isMorn ? data.pm : data.pn;

            document.getElementById('dash-status').innerText = names;
            document.getElementById('passenger-name').innerText = passName;

            // Badge Update
            const badge = document.getElementById('dash-badge');
            badge.className = isMorn ? "badge badge-m" : "badge badge-n";
            badge.innerText = isMorn ? "‚òÄÔ∏è MORNING" : "üåô NIGHT";
        }

        // --- NEW ROSTER RENDERER ---
        function renderRoster() {
            const list = document.getElementById('roster-list');
            const todayIdx = (new Date().getDay() + 6) % 7;

            list.innerHTML = rosterData.map((d, i) => {
                const isToday = i === todayIdx ? "today-glow" : "";
                const todayBadge = i === todayIdx ? "<span class='today-tag'>TODAY</span>" : "";

                // Helper to make pill html
                const makePills = (arr) => arr.map(x =>
                    `<div class="worker-chip"><span>${x.n}</span><span class="time-tiny">${x.t}</span></div>`
                ).join("");

                return `
                    <div class="roster-card ${isToday}">
                        <div class="roster-header">
                            <span>${d.d}</span>
                            ${todayBadge}
                        </div>
                        
                        <div class="shift-row morning">
                            <div class="shift-label-row">
                                <span class="shift-icon">‚òÄÔ∏è Morning</span>
                                <span class="pass-tag">üö´ ${d.pm}</span>
                            </div>
                            <div class="worker-list">
                                ${makePills(d.m)}
                            </div>
                        </div>

                        <div class="shift-row night">
                            <div class="shift-label-row">
                                <span class="shift-icon">üåô Night</span>
                                <span class="pass-tag">üö´ ${d.pn}</span>
                            </div>
                            <div class="worker-list">
                                ${makePills(d.n)}
                            </div>
                        </div>
                    </div>
                `;
            }).join("");
        }

        // --- LOTTERY SYSTEM ---
        function seededRandom(seed) {
            let x = Math.sin(seed++) * 10000;
            return x - Math.floor(x);
        }

        function shuffle(array, seed) {
            let m = array.length, t, i;
            while (m) {
                i = Math.floor(seededRandom(seed + m--) * m);
                t = array[m];
                array[m] = array[i];
                array[i] = t;
            }
            return array;
        }

        function getTodayDateString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function runLottery() {
            /*
            // If penalty is active for today, do not run lottery.
            if (penaltyState && penaltyState.date === getTodayDateString()) {
                return assignTasksToPenalizedPerson();
            }
            */

            const today = new Date();
            const seed = parseInt(`${today.getFullYear()}${today.getMonth() + 1}${today.getDate()}`);
            const assignedPeople = shuffle([...people], seed); // Shuffle people for random assignment order

            let html = "";
            let dashHtml = "";

            tasks.forEach((t, i) => {
                const p = assignedPeople[i % assignedPeople.length]; // Assign tasks cyclically
                html += `<div class="dash-task-row"><span style="font-weight:500">${t}</span><span style="font-weight:700; color:var(--primary)">${p}</span></div>`;
                dashHtml += `<div class="dash-task-row"><span style="color:var(--text-sub)">${t}</span><span style="font-weight:600">${p}</span></div>`;
            });

            document.getElementById('lottery-list').innerHTML = html;
            document.getElementById('lottery-result-card').style.display = "block";
            document.getElementById('dash-task-container').innerHTML = dashHtml;

            const btn = document.getElementById('lottery-draw-btn');
            btn.innerText = "‚úÖ TASKS ASSIGNED";
            btn.style.background = "var(--text-sub)";
            btn.disabled = true;
        }

        /*
        // --- PENALTY SYSTEM ---
        function loadPenaltyState() { ... }
        function updatePenaltyView() { ... }
        function assignPenalty() { ... }
        function assignTasksToPenalizedPerson() { ... }
        function overridePenalty() { ... }
        */

        // --- INIT ---
        // loadPenaltyState();
        updateDashboard();
        renderRoster();
        // updatePenaltyView();
        // document.getElementById('penalty-select').innerHTML = people.map(p => `<option value="${p}">${p}</option>`).join('');
        runLottery(); // Check for penalty and run lottery on load
        setInterval(updateDashboard, 60000);

    </script>
</body>

</html>